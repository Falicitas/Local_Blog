# 树

## 一些习题

### CF1438F Olha and Igor

对于一颗完全二叉树，给定三元组$(u,v,w)$（以$w$为根节点，求出$u,v$的lca）求确定该树的根节点编号。

~~我以为不会用概率来做的题就是靠概率来求答案~~。

该题的lca：以$w$为根节点的树结构，u，v的lca其实是树上节点到三个点$(u,v,w)$的最短距离和。即随意确定树上三个点，不管选哪个点作为根节点，求得的lca都是同个点且距离三个点距离最短。所以三元组$(u,v,w)$的任意排列答案都相同。

考虑随机抽三个点得到的lca（即为点$m$）不等同三个点任意一点的情况。此时点$m$必不在根节点与叶节点（只有其余节点才有三叉子树）。那么对于这些其余节点统计一下被询问的概率是多少（这里仅统计次数即可）。易发现相同层的节点概率相等。对于每一层i的节点作为m点的次数为$cnt = (2^{h-i}-1)^2(2^h - 2^{h-i+1})$，两因数均单减，可以发现根节点的两个子节点最容易被随机访问到。故花420次询问随机访问节点，统计m点出现次数。将最高被访问的两个节点u，v当做ls，rs，O(n)询问每个点。当w=询问点自己，该点为根节点。



问题：给定一个S，问满足严格单增的正整数等比数列和为S。公比为$\frac{p}{q},q\leq 1000$

设首先写成求和式，$\frac{\frac{p}{q}a_n - a_1}{\frac{p}{q}-1} = S$。由于数列为正整数，故$a_n,a_1\in N^+$（反证法易证）

转化一下式子，$\frac{p}{q}(S - a_n) = S-a_1$。由于$S-a_1\in N$，故$q|(S-a_n)$。

枚举$a_n$复杂度为$O(n)$。令$x = S - a_n$，由上面知道$x$可以写成$x = qt$，故原式为$pt = S - a_1$。由于$a_n> a_1\geq 1$，故$a_n > S-pt\geq 1$，由$t$可$O(1)$确定合法的$p$的个数。枚举$q$的复杂度为$O(\sqrt{n})$（上文知$q$为$x$的因子且$q\leq 1000$）。故总复杂度为$O(n\sqrt{n})$。