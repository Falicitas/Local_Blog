# 数论

## 一些习题

### CF1436F Sum Over Subsets

题意：有n个不同值，每个值的数有$freq(x)$个（这里指值为x的有$freq(x)$个）。问取若干数，使数的gcd=1的集合的方案是多少。同值的数两两算不同。

看到gcd=1，经验丰富的选手就套路的上莫比乌斯反演。具体的，设$g_i$为gcd=i的方案数，$f_i$为gcd=i的倍数的方案数，有$f_i = \sum_k g_{ik}$，反演有$g_i = \sum\limits_{i|d}\mu(\frac{d}{i})f(d)$，对于本题即要求$g_1 = \sum\limits_{d=1}^{10^5}\mu(d)f(d)$，问题转化成求$f(i)$的值。

对于$f(d)$，则先把$d$的倍数的数给筛出来。整个过程枚举d后枚举d的倍数，复杂度为$O(n \log n)$。由于每个数视为不同的个体，考虑 **顺序排开数** 。设排开的数大小为$S$。对于式子$\sum\limits_{x \in A} x \cdot \sum\limits_{y \in B} y$肯定不会给你裸的，所以尝试变换一下，变为$\sum\limits_{x \in A} \sum\limits_{y \in B} xy$，即去考虑每对数能产生的贡献值，即权值$xy$乘上出现在集合的次数。

> 对于x=y且是同一个数，在排开的数中唯一确定；接下来要在$S-1$的数中挑一个剔除，该数能被剔除说明A中有这个数，那么A的该位置也唯一确定。对于剩下的$S-2$的位置，可有可没有，那么对于 **某个值** 的同一个数的贡献为$x^2(S-1)*2^{S-2}*freq(x)$（由于同值的共有freq(x)都是同样的情况）
>
> 对于x=y但不同数，同样照上面的剔除思路，得$x^2((S-2)2^{S-3} + 2^{S-2}) freq(x) * (freq(x)-1)$
>
> 对于x!=y，列出贡献$xy((S-2)2^{S-3} + 2^{S-2}) freq(x) * freq(y)$，发现要枚举两个值。。其实不用，先对$x*freq(x)$求和，之后贡献就为$y((S-2)2^{S-3} + 2^{S-2}) * freq(y) * (sum - y*freq(y))$。

然后处理细节就好了。