# FFT&NTT版本2

由于 **循环卷积** 的迫使下，决定重写一篇`FFT/NTT`的介绍。

## DFT & IDFT

DFT即离散傅里叶变换，将$n-1$次多项式转化为关于单位根的点值；IDFT则是将点值转成系数。为什么使用单位根的原因，一是因为单位根的 **三个性质** ，一方面是由于DFT与IDFT可以由单位根关联起来。

对于$A(x)=a_{0}+a_{1} x+a_{2} x^{2}+\ldots+a_{n-1} x^{n-1}$（这里的$n$补成$2^m$的形式）来说，设其带入单位根$w_n^0,w_n^1,\dots,w_n^{n-1}$得到点值$y_0,y_1,\dots,y_{n-1}$。有$y_k = \sum\limits_{i=0}^{n-1}a_i (w_n^k)^i$。

令$Q(x) = y_0 + y_1x + \dots + y_{n-1}x^{n-1}$，即将点值当做$Q$的系数。此时带入共轭单位根$w_n^{-0},w_n^{-1},\dots,w_n^{-(n-1)}$，设得到$z_0,z_1,\dots,z_{n-1}$。对于$z_k$有：

$z_k = \sum\limits_{i=0}^{n-1}y_i(w_n^{-k})^i$

$ = \sum\limits_{i=0}^{n-1}\sum\limits_{j=0}^{n-1}a_j(w_n^{i})^j(w_n^{-k})^i$

$ = \sum\limits_{j=0}^{n-1}a_j\sum\limits_{i=0}^{n-1}(w^{j-k})^i$。看右边的式子像什么？嗯，单位根反演，故有

$z_k = \sum\limits_{j=0}^{n-1}a_j n[n|j-k] = a_kn$

故$a_k = \frac{z_k}{n}$。

故IDFT的实质为带入共轭单位根，最后除以$n$，就得到了原多项式的系数了。

## FFT

仅考虑DFT，由于IDFT的计算思路与DFT一致。

对于多项式$A(x) = \sum a_ix^i$，将其分为两个函数$A_1(x) = [a_0,a_2,\dots,a_{(n-1)/2*2}],A_2(x) = [a_1,a_3,\dots,a_{(n-2)/2*2+1}]$

有$A(x) = A_1(x^2) + xA_2(x^2)$。

当$k<\frac{n}{2}$，对于单位根$w_n^k$，有$A(w_n^k) = A_1(w_n^{2k}) + w_n^kA_2(w_n^{2k})$

$A(w_n^k) = A_1(w_{\frac{n}{2}}^{k}) + w_n^kA_2(w_{\frac{n}{2}}^{k})$

对于单位根$w_n^{k+\frac{n}{2}}$，有$A(w_n^{k+\frac{n}{2}}) = A_1(w_n^{2k+n}) +w_n^{k+\frac{n}{2}}A_2(w_n^{2k+n})$

$A(w_n^{k+\frac{n}{2}}) = A_1(w_{\frac{n}{2}}^k) -w_n^{k}A_2(w_{\frac{n}{2}}^k)$

于是乎，FFT的思路就出来了：分奇偶下放多项式，假定此时的$A_1,A_2$已是点值形式，照式子求出合并后的点值即可。IDFT则是将式子的$w_n^k$共轭一下即可（或者预处理出共轭单位复根，然后直接求，记得除$n$）。

